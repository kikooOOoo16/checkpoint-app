<!DOCTYPE html>
<html lang="en">
<head>
    <%- include('partials/head') %>
</head>
<body class="centered-layout fade-in">
<div class="login-card">
    <div class="card-header-image">
        <img src="/images/login-header.jpg" alt="Login Header">
    </div>

    <form id="loginForm">
        <div id="error"></div>

        <div class="form-group">
            <label for="email">Email</label>
            <input type="email" id="email" name="email" placeholder="example@example.com" required>
        </div>

        <div class="form-group">
            <a href="#" class="forgot-password">Forgot Password?</a>
            <label for="password">Password</label>
            <div class="input-wrapper">
                <input type="password" id="password" name="password" required>
                <i class="fas fa-eye password-toggle" id="togglePassword"></i>
            </div>
        </div>

        <div class="remember-me">
            <input type="checkbox" id="remember" name="remember">
            <label for="remember" style="margin-bottom: 0; margin-left: 5px;">Remember me</label>
        </div>

        <button type="submit" class="btn-login">Login</button>
    </form>

    <div class="footer">
        <div class="visitor-section">
            <div class="visitor-text">
                Don't have an account?<br>
                Login as a visitor.
            </div>
            <a href="/registration" class="btn-visitor">Visitor Login</a>
        </div>

        <div class="mt-4 text-center">
            <a href="/admin/login"
               style="color: var(--secondary-text); font-size: 12px; text-decoration: none; text-transform: uppercase;">Administrator
                Login</a>
        </div>
    </div>
</div>

<%- include('partials/toasts') %>
<%- include('partials/scripts') %>

<script>
  const togglePassword = document.querySelector('#togglePassword');
  const password = document.querySelector('#password');

  togglePassword.addEventListener('click', function(e) {
    const type = password.getAttribute('type') === 'password' ? 'text' : 'password';
    password.setAttribute('type', type);
    this.classList.toggle('fa-eye-slash');
  });

  document.getElementById('loginForm').onsubmit = async (e) => {
    e.preventDefault();
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    const res = await fetch('/login', {
      method: 'POST',
      headers: {'Content-Type': 'application/json', 'Accept': 'application/json'},
      body: JSON.stringify({email, password})
    });
    const data = await res.json();
    if (data.redirect) {
      window.location.href = data.redirect;
    } else {
      document.getElementById('errorToastMessage').innerText = data.error;
      const errorToast = new bootstrap.Toast(document.getElementById('errorToast'), {
        delay: 7000,
        autohide: true,
        animation: true
      });
      errorToast.show();
    }
  };
</script>
</body>
</html>
